# Building DiffGraph CLI

This document explains how to build the DiffGraph CLI into a standalone executable using PyInstaller.

## Prerequisites

1. Make sure you have a virtual environment set up:
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

2. Install dependencies:
   ```bash
   pip3 install -r requirements.txt
   ```

## Building the Binary

### Using the build script (Recommended)

```bash
python3 build.py
```

The build script will:
- ✅ Check if PyInstaller is installed
- ✅ Auto-generate the `wild.spec` file using PyInstaller if it doesn't exist
- ✅ Ensure the `.env` file is included in the spec file (if it exists)
- ✅ Clean previous builds
- ✅ Build the binary using the optimized spec file
- ✅ Output the binary to `dist/wild`

### Manual PyInstaller command

```bash
pyinstaller wild.spec --clean
```

### Simple PyInstaller command (not recommended)

```bash
pyinstaller --onefile --name wild diffgraph/cli.py
```

## Troubleshooting

### Import Error Issues

If you encounter import errors like:
```
ImportError: attempted relative import with no known parent package
```

This is because PyInstaller is trying to run a module with relative imports as a standalone script. The build script automatically creates a proper spec file that handles these imports correctly.

### Missing Dependencies

If the binary is missing dependencies, you can add them to the `hiddenimports` list in `wild.spec`:

```python
hiddenimports=[
    'diffgraph.ai_analysis',
    'diffgraph.html_report',
    # ... add more as needed
],
```

**Note**: The `wild.spec` file is auto-generated by the build script and is gitignored. If you need to modify it, the changes will be preserved for future builds.

### File Size Issues

The binary might be large due to included dependencies. You can reduce size by:

1. Using `--onefile` flag (already in spec)
2. Excluding unnecessary modules in the spec file
3. Using UPX compression (already enabled in spec)

## Testing the Binary

After building, test the binary:

```bash
./dist/wild --help
```

## Features

### Automatic .env Inclusion

The build script automatically includes the `.env` file in the binary if it exists. This ensures that environment variables are packaged with the executable.

### Virtual Environment Support

The build script works best with a virtual environment to avoid system Python conflicts.

## Troubleshooting

### Import Errors

If you see import errors, make sure:
1. You're using a virtual environment
2. All dependencies are installed: `pip install -r requirements.txt`
3. PyInstaller is installed: `pip install pyinstaller`

### Missing .env File

The build script will automatically detect if a `.env` file exists and include it in the build. If you don't have a `.env` file, the build will still work but environment variables won't be packaged.

## Distribution

The built binary (`dist/wild`) can be distributed as a standalone executable. Users don't need Python installed to run it.

## File Size

The binary is approximately 20MB, which includes all dependencies and the Python runtime.

## Platform-Specific Notes

- **macOS**: The binary will be named `wild`
- **Windows**: The binary will be named `wild.exe`
- **Linux**: The binary will be named `wild`

Make sure to build on the target platform for best compatibility.